import{J as pr,K as v,L as Ke,M as _n,N as _r,O as gr,P as yr,a as Tr,_ as gn,Q as wr,R as Er,S as Ar,T as wt,U as Ir,V as vr,W as Vr,X as Pr,Y as Qt,Z as Rr}from"./firebase-3MFUNIUm.js";const Gt="4.9.0";class b{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}b.UNAUTHENTICATED=new b(null),b.GOOGLE_CREDENTIALS=new b("google-credentials-uid"),b.FIRST_PARTY=new b("first-party-uid"),b.MOCK_USER=new b("mock-user");let me="12.0.0";const Y=new Er("@firebase/firestore");function Ui(n){Y.setLogLevel(n)}function X(n,...e){if(Y.logLevel<=wt.DEBUG){const t=e.map(Et);Y.debug(`Firestore (${me}): ${n}`,...t)}}function We(n,...e){if(Y.logLevel<=wt.ERROR){const t=e.map(Et);Y.error(`Firestore (${me}): ${n}`,...t)}}function yn(n,...e){if(Y.logLevel<=wt.WARN){const t=e.map(Et);Y.warn(`Firestore (${me}): ${n}`,...t)}}function Et(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function _(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Tn(n,r,t)}function Tn(n,e,t){let r=`FIRESTORE (${me}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw We(r),new Error(r)}function F(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||Tn(e,i,r)}function Z(n,e){return n}const ht="ok",At="cancelled",de="unknown",d="invalid-argument",wn="deadline-exceeded",It="not-found",Sr="already-exists",En="permission-denied",Oe="unauthenticated",An="resource-exhausted",Q="failed-precondition",vt="aborted",In="out-of-range",Vt="unimplemented",vn="internal",Vn="unavailable",br="data-loss";class c extends pr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Pt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Pn{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class kr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(b.UNAUTHENTICATED)))}shutdown(){}}class Fr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Nr{constructor(e){this.auth=null,e.onInit((t=>{this.auth=t}))}getToken(){return this.auth?this.auth.getToken().then((e=>e?(F(typeof e.accessToken=="string",42297,{t:e}),new Pn(e.accessToken,new b(this.auth.getUid()))):null)):Promise.resolve(null)}invalidateToken(){}start(e,t){}shutdown(){}}class Dr{constructor(e,t,r){this.i=e,this.o=t,this.u=r,this.type="FirstParty",this.user=b.FIRST_PARTY,this.l=new Map}h(){return this.u?this.u():null}get headers(){this.l.set("X-Goog-AuthUser",this.i);const e=this.h();return e&&this.l.set("Authorization",e),this.o&&this.l.set("X-Goog-Iam-Authorization-Token",this.o),this.l}}class xr{constructor(e,t,r){this.i=e,this.o=t,this.u=r}getToken(){return Promise.resolve(new Dr(this.i,this.o,this.u))}start(e,t){e.enqueueRetryable((()=>t(b.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Kt{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class qr{constructor(e,t){this.m=t,this.appCheck=null,this.T=null,Rr(e)&&e.settings.appCheckToken&&(this.T=e.settings.appCheckToken),t.onInit((r=>{this.appCheck=r}))}getToken(){return this.T?Promise.resolve(new Kt(this.T)):this.appCheck?this.appCheck.getToken().then((e=>e?(F(typeof e.token=="string",3470,{tokenResult:e}),new Kt(e.token)):null)):Promise.resolve(null)}invalidateToken(){}start(e,t){}shutdown(){}}class Or{constructor(e,t,r,i,s,o,a,u,l,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=l,this.isUsingEmulator=h}}const Ce="(default)";class we{constructor(e,t){this.projectId=e,this.database=t||Ce}static empty(){return new we("","")}get isDefaultDatabase(){return this.database===Ce}isEqual(e){return e instanceof we&&e.projectId===this.projectId&&e.database===this.database}}function Cr(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Lr{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=Cr(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}}function E(n,e){return n<e?-1:n>e?1:0}function dt(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const i=n.charAt(r),s=e.charAt(r);if(i!==s)return at(i)===at(s)?E(i,s):at(i)?1:-1}return E(n.length,e.length)}const $r=55296,Mr=57343;function at(n){const e=n.charCodeAt(0);return e>=$r&&e<=Mr}function Rt(n,e,t){return n.length===e.length&&n.every(((r,i)=>t(r,e[i])))}const ft="__name__";class j{constructor(e,t,r){t===void 0?t=0:t>e.length&&_(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&_(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return j.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof j?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=j.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return E(e.length,t.length)}static compareSegments(e,t){const r=j.isNumericId(e),i=j.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?j.extractNumericId(e).compare(j.extractNumericId(t)):dt(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ir.fromString(e.substring(4,e.length-2))}}class y extends j{construct(e,t,r){return new y(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new c(d,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((i=>i.length>0)))}return new y(t)}static emptyPath(){return new y([])}}const Ur=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class k extends j{construct(e,t,r){return new k(e,t,r)}static isValidIdentifier(e){return Ur.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),k.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===ft}static keyField(){return new k([ft])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(r.length===0)throw new c(d,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new c(d,"Path has trailing escape character: "+e);const u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new c(d,"Path has invalid escape sequence: "+e);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new c(d,"Unterminated ` in path: "+e);return new k(t)}static emptyPath(){return new k([])}}class T{constructor(e){this.path=e}static fromPath(e){return new T(y.fromString(e))}static fromName(e){return new T(y.fromString(e).popFirst(5))}static empty(){return new T(y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&y.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return y.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new T(new y(e.slice()))}}function St(n,e,t){if(!t)throw new c(d,`Function ${n}() cannot be called with an empty ${e}.`)}function Wt(n){if(!T.isDocumentKey(n))throw new c(d,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Jt(n){if(T.isDocumentKey(n))throw new c(d,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Rn(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Je(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":_(12329,{type:typeof n})}function L(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new c(d,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Je(n);throw new c(d,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Sn(n,e){if(e<=0)throw new c(d,`Function ${n}() requires a positive number, but it was: ${e}.`)}function bn(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}let De=null;function jr(){return De===null?De=(function(){return 268435456+Math.round(2147483648*Math.random())})():De++,"0x"+De.toString(16)}function kn(n){return n==null}function Le(n){return n===0&&1/n==-1/0}const ut="RestConnection",Br={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class zr{get P(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.A=t+"://"+e.host,this.R=`projects/${r}/databases/${i}`,this.V=this.databaseId.database===Ce?`project_id=${r}`:`project_id=${r}&database_id=${i}`}I(e,t,r,i,s){const o=jr(),a=this.p(e,t.toUriEncodedString());X(ut,`Sending RPC '${e}' ${o}:`,a,r);const u={"google-cloud-resource-prefix":this.R,"x-goog-request-params":this.V};this.F(u,i,s);const{host:l}=new URL(a),h=_n(l);return this.v(e,a,u,r,h).then((f=>(X(ut,`Received RPC '${e}' ${o}: `,f),f)),(f=>{throw yn(ut,`RPC '${e}' ${o} failed with error: `,f,"url: ",a,"request:",r),f}))}D(e,t,r,i,s,o){return this.I(e,t,r,i,s)}F(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+me})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((i,s)=>e[s]=i)),r&&r.headers.forEach(((i,s)=>e[s]=i))}p(e,t){const r=Br[e];return`${this.A}/v1/${t}:${r}`}terminate(){}}var Ht,p;function Yt(n){if(n===void 0)return We("RPC_ERROR","HTTP error has no status"),de;switch(n){case 200:return ht;case 400:return Q;case 401:return Oe;case 403:return En;case 404:return It;case 409:return vt;case 416:return In;case 429:return An;case 499:return At;case 500:return de;case 501:return Vt;case 503:return Vn;case 504:return wn;default:return n>=200&&n<300?ht:n>=400&&n<500?Q:n>=500&&n<600?vn:de}}(p=Ht||(Ht={}))[p.OK=0]="OK",p[p.CANCELLED=1]="CANCELLED",p[p.UNKNOWN=2]="UNKNOWN",p[p.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",p[p.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",p[p.NOT_FOUND=5]="NOT_FOUND",p[p.ALREADY_EXISTS=6]="ALREADY_EXISTS",p[p.PERMISSION_DENIED=7]="PERMISSION_DENIED",p[p.UNAUTHENTICATED=16]="UNAUTHENTICATED",p[p.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",p[p.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",p[p.ABORTED=10]="ABORTED",p[p.OUT_OF_RANGE=11]="OUT_OF_RANGE",p[p.UNIMPLEMENTED=12]="UNIMPLEMENTED",p[p.INTERNAL=13]="INTERNAL",p[p.UNAVAILABLE=14]="UNAVAILABLE",p[p.DATA_LOSS=15]="DATA_LOSS";class Qr extends zr{S(e,t){throw new Error("Not supported by FetchConnection")}async v(e,t,r,i,s){const o=JSON.stringify(i);let a;try{const u={method:"POST",headers:r,body:o};s&&(u.credentials="include"),a=await fetch(t,u)}catch(u){const l=u;throw new c(Yt(l.status),"Request failed with error: "+l.statusText)}if(!a.ok){let u=await a.json();Array.isArray(u)&&(u=u[0]);const l=u?.error?.message;throw new c(Yt(a.status),`Request failed with error: ${l??a.statusText}`)}return a.json()}}class Gr{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}function Xt(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Re(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}class Kr extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class G{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Kr("Invalid base64 string: "+s):s}})(e);return new G(t)}static fromUint8Array(e){const t=(function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s})(e);return new G(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return E(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}G.EMPTY_BYTE_STRING=new G("");const Wr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ee(n){if(F(!!n,39018),typeof n=="string"){let e=0;const t=Wr.exec(n);if(F(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:A(n.seconds),nanos:A(n.nanos)}}function A(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ee(n){return typeof n=="string"?G.fromBase64String(n):G.fromUint8Array(n)}function C(n,e){const t={typeString:n};return e&&(t.value=e),t}function Se(n,e){if(!Rn(n))throw new c(d,"JSON must be an object");let t;for(const r in e)if(e[r]){const i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(i&&typeof o!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&o!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new c(d,t);return!0}const Zt=-62135596800,en=1e6;class I{static now(){return I.fromMillis(Date.now())}static fromDate(e){return I.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*en);return new I(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new c(d,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new c(d,"Timestamp nanoseconds out of range: "+t);if(e<Zt)throw new c(d,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new c(d,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/en}_compareTo(e){return this.seconds===e.seconds?E(this.nanoseconds,e.nanoseconds):E(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:I._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Se(e,I._jsonSchema))return new I(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Zt;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}I._jsonSchemaVersion="firestore/timestamp/1.0",I._jsonSchema={type:C("string",I._jsonSchemaVersion),seconds:C("number"),nanoseconds:C("number")};function bt(n){return(n?.mapValue?.fields||{}).__type__?.stringValue==="server_timestamp"}function Fn(n){const e=n.mapValue.fields.__previous_value__;return bt(e)?Fn(e):e}function Ae(n){const e=ee(n.mapValue.fields.__local_write_time__.timestampValue);return new I(e.seconds,e.nanos)}const Nn="__type__",Jr="__max__",xe={},Dn="__vector__",$e="value";function te(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?bt(n)?4:(function(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===Jr})(n)?9007199254740991:(function(t){return(t?.mapValue?.fields||{})[Nn]?.stringValue===Dn})(n)?10:11:_(28295,{value:n})}function fe(n,e){if(n===e)return!0;const t=te(n);if(t!==te(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ae(n).isEqual(Ae(e));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=ee(i.timestampValue),a=ee(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,s){return Ee(i.bytesValue).isEqual(Ee(s.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,s){return A(i.geoPointValue.latitude)===A(s.geoPointValue.latitude)&&A(i.geoPointValue.longitude)===A(s.geoPointValue.longitude)})(n,e);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return A(i.integerValue)===A(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=A(i.doubleValue),a=A(s.doubleValue);return o===a?Le(o)===Le(a):isNaN(o)&&isNaN(a)}return!1})(n,e);case 9:return Rt(n.arrayValue.values||[],e.arrayValue.values||[],fe);case 10:case 11:return(function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(Xt(o)!==Xt(a))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!fe(o[u],a[u])))return!1;return!0})(n,e);default:return _(52216,{left:n})}}function Ie(n,e){return(n.values||[]).find((t=>fe(t,e)))!==void 0}function Me(n,e){if(n===e)return 0;const t=te(n),r=te(e);if(t!==r)return E(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return E(n.booleanValue,e.booleanValue);case 2:return(function(s,o){const a=A(s.integerValue||s.doubleValue),u=A(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1})(n,e);case 3:return tn(n.timestampValue,e.timestampValue);case 4:return tn(Ae(n),Ae(e));case 5:return dt(n.stringValue,e.stringValue);case 6:return(function(s,o){const a=Ee(s),u=Ee(o);return a.compareTo(u)})(n.bytesValue,e.bytesValue);case 7:return(function(s,o){const a=s.split("/"),u=o.split("/");for(let l=0;l<a.length&&l<u.length;l++){const h=E(a[l],u[l]);if(h!==0)return h}return E(a.length,u.length)})(n.referenceValue,e.referenceValue);case 8:return(function(s,o){const a=E(A(s.latitude),A(o.latitude));return a!==0?a:E(A(s.longitude),A(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return nn(n.arrayValue,e.arrayValue);case 10:return(function(s,o){const a=s.fields||{},u=o.fields||{},l=a[$e]?.arrayValue,h=u[$e]?.arrayValue,f=E(l?.values?.length||0,h?.values?.length||0);return f!==0?f:nn(l,h)})(n.mapValue,e.mapValue);case 11:return(function(s,o){if(s===xe&&o===xe)return 0;if(s===xe)return 1;if(o===xe)return-1;const a=s.fields||{},u=Object.keys(a),l=o.fields||{},h=Object.keys(l);u.sort(),h.sort();for(let f=0;f<u.length&&f<h.length;++f){const m=dt(u[f],h[f]);if(m!==0)return m;const P=Me(a[u[f]],l[h[f]]);if(P!==0)return P}return E(u.length,h.length)})(n.mapValue,e.mapValue);default:throw _(23264,{C:t})}}function tn(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return E(n,e);const t=ee(n),r=ee(e),i=E(t.seconds,r.seconds);return i!==0?i:E(t.nanos,r.nanos)}function nn(n,e){const t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){const s=Me(t[i],r[i]);if(s)return s}return E(t.length,r.length)}function Ue(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function xn(n){return!!n&&"arrayValue"in n}function rn(n){return!!n&&"nullValue"in n}function sn(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function lt(n){return!!n&&"mapValue"in n}function ge(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Re(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=ge(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ge(n.arrayValue.values[t]);return e}return{...n}}class je{constructor(e,t){this.position=e,this.inclusive=t}}function on(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!fe(n.position[t],e.position[t]))return!1;return!0}class qn{}class D extends qn{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Hr(e,t,r):t==="array-contains"?new Zr(e,r):t==="in"?new ei(e,r):t==="not-in"?new ti(e,r):t==="array-contains-any"?new ni(e,r):new D(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Yr(e,r):new Xr(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Me(t,this.value)):t!==null&&te(this.value)===te(t)&&this.matchesComparison(Me(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return _(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ne extends qn{constructor(e,t){super(),this.filters=e,this.op=t,this.N=null}static create(e,t){return new ne(e,t)}matches(e){return(function(r){return r.op==="and"})(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.N!==null||(this.N=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.N}getFilters(){return Object.assign([],this.filters)}}function On(n,e){return n instanceof D?(function(r,i){return i instanceof D&&r.op===i.op&&r.field.isEqual(i.field)&&fe(r.value,i.value)})(n,e):n instanceof ne?(function(r,i){return i instanceof ne&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((s,o,a)=>s&&On(o,i.filters[a])),!0):!1})(n,e):void _(19439)}class Hr extends D{constructor(e,t,r){super(e,t,r),this.key=T.fromName(r.referenceValue)}matches(e){const t=T.comparator(e.key,this.key);return this.matchesComparison(t)}}class Yr extends D{constructor(e,t){super(e,"in",t),this.keys=Cn("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Xr extends D{constructor(e,t){super(e,"not-in",t),this.keys=Cn("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Cn(n,e){return(e.arrayValue?.values||[]).map((t=>T.fromName(t.referenceValue)))}class Zr extends D{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return xn(t)&&Ie(t.arrayValue,this.value)}}class ei extends D{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ie(this.value.arrayValue,t)}}class ti extends D{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ie(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ie(this.value.arrayValue,t)}}class ni extends D{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!xn(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Ie(this.value.arrayValue,r)))}}class Be{constructor(e,t="asc"){this.field=e,this.dir=t}}function ri(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class w{static fromTimestamp(e){return new w(e)}static min(){return new w(new I(0,0))}static max(){return new w(new I(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ze{constructor(e,t){this.comparator=e,this.root=t||R.EMPTY}insert(e,t){return new ze(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,R.BLACK,null,null))}remove(e){return new ze(this.comparator,this.root.remove(e,this.comparator).copy(null,null,R.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new qe(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new qe(this.root,e,this.comparator,!1)}getReverseIterator(){return new qe(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new qe(this.root,e,this.comparator,!0)}}class qe{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class R{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??R.RED,this.left=i??R.EMPTY,this.right=s??R.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new R(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return R.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return R.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,R.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,R.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw _(43730,{key:this.key,value:this.value});if(this.right.isRed())throw _(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw _(27949);return e+(this.isRed()?0:1)}}R.EMPTY=null,R.RED=!0,R.BLACK=!1;R.EMPTY=new class{constructor(){this.size=0}get key(){throw _(57766)}get value(){throw _(16141)}get color(){throw _(16727)}get left(){throw _(29726)}get right(){throw _(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new R(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ve{constructor(e){this.comparator=e,this.data=new ze(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new an(this.data.getIterator())}getIteratorFrom(e){return new an(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof ve)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new ve(this.comparator);return t.data=e,t}}class an{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class re{constructor(e){this.fields=e,e.sort(k.comparator)}static empty(){return new re([])}unionWith(e){let t=new ve(k.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new re(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Rt(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class N{constructor(e){this.value=e}static empty(){return new N({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!lt(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ge(t)}setAll(e){let t=k.emptyPath(),r={},i=[];e.forEach(((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=ge(o):i.push(a.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());lt(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return fe(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];lt(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Re(t,((i,s)=>e[i]=s));for(const i of r)delete e[i]}clone(){return new N(ge(this.value))}}class B{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new B(e,0,w.min(),w.min(),w.min(),N.empty(),0)}static newFoundDocument(e,t,r,i){return new B(e,1,t,w.min(),r,i,0)}static newNoDocument(e,t){return new B(e,2,t,w.min(),w.min(),N.empty(),0)}static newUnknownDocument(e,t){return new B(e,3,t,w.min(),w.min(),N.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(w.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=N.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=N.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=w.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof B&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new B(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ii{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.O=null}}function un(n,e=null,t=[],r=[],i=null,s=null,o=null){return new ii(n,e,t,r,i,s,o)}class se{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.q=null,this.B=null,this.$=null,this.startAt,this.endAt}}function Ln(n){return n.collectionGroup!==null}function $n(n){const e=Z(n);if(e.q===null){e.q=[];const t=new Set;for(const s of e.explicitOrderBy)e.q.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ve(k.comparator);return o.filters.forEach((u=>{u.getFlattenedFilters().forEach((l=>{l.isInequality()&&(a=a.add(l.field))}))})),a})(e).forEach((s=>{t.has(s.canonicalString())||s.isKeyField()||e.q.push(new Be(s,r))})),t.has(k.keyField().canonicalString())||e.q.push(new Be(k.keyField(),r))}return e.q}function mt(n){const e=Z(n);return e.B||(e.B=Mn(e,$n(n))),e.B}function Mn(n,e){if(n.limitType==="F")return un(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((i=>{const s=i.dir==="desc"?"asc":"desc";return new Be(i.field,s)}));const t=n.endAt?new je(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new je(n.startAt.position,n.startAt.inclusive):null;return un(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function pt(n,e){const t=n.filters.concat([e]);return new se(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function si(n,e){return(function(r,i){if(r.limit!==i.limit||r.orderBy.length!==i.orderBy.length)return!1;for(let s=0;s<r.orderBy.length;s++)if(!ri(r.orderBy[s],i.orderBy[s]))return!1;if(r.filters.length!==i.filters.length)return!1;for(let s=0;s<r.filters.length;s++)if(!On(r.filters[s],i.filters[s]))return!1;return r.collectionGroup===i.collectionGroup&&!!r.path.isEqual(i.path)&&!!on(r.startAt,i.startAt)&&on(r.endAt,i.endAt)})(mt(n),mt(e))&&n.limitType===e.limitType}function Un(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Le(e)?"-0":e}}function jn(n,e){return(function(r){return typeof r=="number"&&Number.isInteger(r)&&!Le(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER})(e)?(function(r){return{integerValue:""+r}})(e):Un(n,e)}class He{constructor(){this._=void 0}}class Bn extends He{}class zn extends He{constructor(e){super(),this.elements=e}}class Qn extends He{constructor(e){super(),this.elements=e}}class Gn extends He{constructor(e,t){super(),this.serializer=e,this.k=t}}class Ye{constructor(e,t){this.field=e,this.transform=t}}class S{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new S}static exists(e){return new S(void 0,e)}static updateTime(e){return new S(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}class Xe{}class Kn extends Xe{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class kt extends Xe{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}class Ze extends Xe{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Wn extends Xe{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}const oi={asc:"ASCENDING",desc:"DESCENDING"},ai={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ui={and:"AND",or:"OR"};class li{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function _t(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ci(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function hi(n,e){return _t(n,e.toTimestamp())}function ye(n){return F(!!n,49232),w.fromTimestamp((function(t){const r=ee(t);return new I(r.seconds,r.nanos)})(n))}function Ft(n,e){return gt(n,e).canonicalString()}function gt(n,e){const t=(function(i){return new y(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Qe(n,e){return Ft(n.databaseId,e.path)}function yt(n,e){const t=(function(i){const s=y.fromString(i);return F(Yn(s),10190,{key:s.toString()}),s})(e);if(t.get(1)!==n.databaseId.projectId)throw new c(d,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new c(d,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new T((function(i){return F(i.length>4&&i.get(4)==="documents",29091,{key:i.toString()}),i.popFirst(5)})(t))}function ln(n,e,t){return{name:Qe(n,e),fields:t.value.mapValue.fields}}function di(n,e){return"found"in e?(function(r,i){F(!!i.found,43571),i.found.name,i.found.updateTime;const s=yt(r,i.found.name),o=ye(i.found.updateTime),a=i.found.createTime?ye(i.found.createTime):w.min(),u=new N({mapValue:{fields:i.found.fields}});return B.newFoundDocument(s,o,a,u)})(n,e):"missing"in e?(function(r,i){F(!!i.missing,3894),F(!!i.readTime,22933);const s=yt(r,i.missing),o=ye(i.readTime);return B.newNoDocument(s,o)})(n,e):_(7234,{result:e})}function fi(n,e){let t;if(e instanceof Kn)t={update:ln(n,e.key,e.value)};else if(e instanceof Ze)t={delete:Qe(n,e.key)};else if(e instanceof kt)t={update:ln(n,e.key,e.data),updateMask:gi(e.fieldMask)};else{if(!(e instanceof Wn))return _(16599,{L:e.type});t={verify:Qe(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(s,o){const a=o.transform;if(a instanceof Bn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof zn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Qn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Gn)return{fieldPath:o.field.canonicalString(),increment:a.k};throw _(20930,{transform:o.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(i,s){return s.updateTime!==void 0?{updateTime:hi(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:_(27497)})(n,e.precondition)),t}function Jn(n,e){const t={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=(function(l,h){return Ft(l.databaseId,h)})(n,i);const s=(function(l){if(l.length!==0)return Hn(ne.create(l,"and"))})(e.filters);s&&(t.structuredQuery.where=s);const o=(function(l){if(l.length!==0)return l.map((h=>(function(m){return{field:J(m.field),direction:mi(m.dir)}})(h)))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=(function(l,h){return l.useProto3Json||kn(h)?h:{value:h}})(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=(function(l){return{before:l.inclusive,values:l.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(l){return{before:!l.inclusive,values:l.position}})(e.endAt)),{M:t,parent:i}}function mi(n){return oi[n]}function pi(n){return ai[n]}function _i(n){return ui[n]}function J(n){return{fieldPath:n.canonicalString()}}function Hn(n){return n instanceof D?(function(t){if(t.op==="=="){if(sn(t.value))return{unaryFilter:{field:J(t.field),op:"IS_NAN"}};if(rn(t.value))return{unaryFilter:{field:J(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(sn(t.value))return{unaryFilter:{field:J(t.field),op:"IS_NOT_NAN"}};if(rn(t.value))return{unaryFilter:{field:J(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:J(t.field),op:pi(t.op),value:t.value}}})(n):n instanceof ne?(function(t){const r=t.getFilters().map((i=>Hn(i)));return r.length===1?r[0]:{compositeFilter:{op:_i(t.op),filters:r}}})(n):_(54877,{filter:n})}function gi(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Yn(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function Nt(n){return new li(n,!0)}class Xn{constructor(e,t,r=1e3,i=1.5,s=6e4){this.U=e,this.timerId=t,this.j=r,this.W=i,this.K=s,this.G=0,this.J=null,this.H=Date.now(),this.reset()}reset(){this.G=0}Y(){this.G=this.K}Z(e){this.cancel();const t=Math.floor(this.G+this.X()),r=Math.max(0,Date.now()-this.H),i=Math.max(0,t-r);i>0&&X("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.G} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.J=this.U.enqueueAfterDelay(this.timerId,i,(()=>(this.H=Date.now(),e()))),this.G*=this.W,this.G<this.j&&(this.G=this.j),this.G>this.K&&(this.G=this.K)}tt(){this.J!==null&&(this.J.skipDelay(),this.J=null)}cancel(){this.J!==null&&(this.J.cancel(),this.J=null)}X(){return(Math.random()-.5)*this.G}}class yi{}class Ti extends yi{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.et=!1}rt(){if(this.et)throw new c(Q,"The client has already been terminated.")}I(e,t,r,i){return this.rt(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.I(e,gt(t,r),i,s,o))).catch((s=>{throw s.name==="FirebaseError"?(s.code===Oe&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new c(de,s.toString())}))}D(e,t,r,i,s){return this.rt(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.D(e,gt(t,r),i,o,a,s))).catch((o=>{throw o.name==="FirebaseError"?(o.code===Oe&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new c(de,o.toString())}))}terminate(){this.et=!0,this.connection.terminate()}}async function pe(n,e){const t=Z(n),r={writes:e.map((i=>fi(t.serializer,i)))};await t.I("Commit",t.serializer.databaseId,y.emptyPath(),r)}async function Zn(n,e){const t=Z(n),r={documents:e.map((a=>Qe(t.serializer,a)))},i=await t.D("BatchGetDocuments",t.serializer.databaseId,y.emptyPath(),r,e.length),s=new Map;i.forEach((a=>{const u=di(t.serializer,a);s.set(u.key.toString(),u)}));const o=[];return e.forEach((a=>{const u=s.get(a.toString());F(!!u,55234,{key:a}),o.push(u)})),o}async function wi(n,e){const t=Z(n),{M:r,parent:i}=Jn(t.serializer,mt(e));return(await t.D("RunQuery",t.serializer.databaseId,i,{structuredQuery:r.structuredQuery})).filter((s=>!!s.document)).map((s=>(function(a,u,l){const h=yt(a,u.name),f=ye(u.updateTime),m=u.createTime?ye(u.createTime):w.min(),P=new N({mapValue:{fields:u.fields}}),V=B.newFoundDocument(h,f,m,P);return l?V.setHasCommittedMutations():V})(t.serializer,s.document,void 0)))}async function Ei(n,e,t){const r=Z(n),{request:i,nt:s,parent:o}=(function(h,f,m,P){const{M:V,parent:q}=Jn(h,f),$={},ce=[];let mr=0;return m.forEach((he=>{const Ne="aggregate_"+mr++;$[Ne]=he.alias,he.aggregateType==="count"?ce.push({alias:Ne,count:{}}):he.aggregateType==="avg"?ce.push({alias:Ne,avg:{field:J(he.fieldPath)}}):he.aggregateType==="sum"&&ce.push({alias:Ne,sum:{field:J(he.fieldPath)}})})),{request:{structuredAggregationQuery:{aggregations:ce,structuredQuery:V.structuredQuery},parent:V.parent},nt:$,parent:q}})(r.serializer,(function(h){const f=Z(h);return f.$||(f.$=Mn(f,h.explicitOrderBy)),f.$})(e),t);r.connection.P||delete i.parent;const a=(await r.D("RunAggregationQuery",r.serializer.databaseId,o,i,1)).filter((l=>!!l.result));F(a.length===1,64727);const u=a[0].result?.aggregateFields;return Object.keys(u).reduce(((l,h)=>(l[s[h]]=u[h],l)),{})}const er="ComponentProvider",Te=new Map;function K(n){if(n._terminated)throw new c(Q,"The client has already been terminated.");if(!Te.has(n)){X(er,"Initializing Datastore");const e=(function(s){return new Qr(s)})((function(s,o,a,u){return new Or(s,o,a,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,bn(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(n._databaseId,n.app.options.appId||"",n._persistenceKey,n._freezeSettings())),t=Nt(n._databaseId),r=(function(s,o,a,u){return new Ti(s,o,a,u)})(n._authCredentials,n._appCheckCredentials,e,t);Te.set(n,r)}return Te.get(n)}const Ai=1048576,tr="firestore.googleapis.com",cn=!0;class hn{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new c(d,"Can't provide ssl option if host option is not set");this.host=tr,this.ssl=cn}else this.host=e.host,this.ssl=e.ssl??cn;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Ai)throw new c(d,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(r,i,s,o){if(i===!0&&o===!0)throw new c(d,`${r} and ${s} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=bn(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new c(d,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new c(d,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new c(d,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class W{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hn({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new c(Q,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new c(Q,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hn(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new kr;switch(r.type){case"firstParty":return new xr(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new c(d,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=Te.get(t);r&&(X(er,"Removing Datastore"),Te.delete(t),r.terminate())})(this),Promise.resolve()}}function Bi(n,e,t){t||(t=Ce);const r=gn(n,"firestore/lite");if(r.isInitialized(t))throw new c(Q,"Firestore can only be initialized once per app.");return r.initialize({options:e,instanceIdentifier:t})}function zi(n,e){const t=typeof n=="object"?n:Tr(),r=typeof n=="string"?n:e||"(default)",i=gn(t,"firestore/lite").getImmediate({identifier:r});if(!i._initialized){const s=wr("firestore");s&&Ii(i,...s)}return i}function Ii(n,e,t,r={}){n=L(n,W);const i=_n(e),s=n._getSettings(),o={...s,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;i&&(_r(`https://${a}`),gr("Firestore",!0)),s.host!==tr&&s.host!==a&&yn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...s,host:a,ssl:i,emulatorOptions:r};if(!Ke(u,o)&&(n._setSettings(u),r.mockUserToken)){let l,h;if(typeof r.mockUserToken=="string")l=r.mockUserToken,h=b.MOCK_USER;else{l=yr(r.mockUserToken,n._app?.options.projectId);const f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new c(d,"mockUserToken must contain 'sub' or 'user_id' field!");h=new b(f)}n._authCredentials=new Fr(new Pn(l,h))}}function Qi(n){return n=L(n,W),Ar(n.app,"firestore/lite"),n._delete()}class Ve{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class vi{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class x{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new x(this.firestore,e,this._query)}}class g{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new M(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new g(this.firestore,e,this._key)}toJSON(){return{type:g._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Se(t,g._jsonSchema))return new g(e,r||null,new T(y.fromString(t.referencePath)))}}g._jsonSchemaVersion="firestore/documentReference/1.0",g._jsonSchema={type:C("string",g._jsonSchemaVersion),referencePath:C("string")};class M extends x{constructor(e,t,r){super(e,t,(function(s){return new se(s)})(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new g(this.firestore,null,new T(e))}withConverter(e){return new M(this.firestore,e,this._path)}}function Gi(n,e,...t){if(n=v(n),St("collection","path",e),n instanceof W){const r=y.fromString(e,...t);return Jt(r),new M(n,null,r)}{if(!(n instanceof g||n instanceof M))throw new c(d,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(y.fromString(e,...t));return Jt(r),new M(n.firestore,null,r)}}function Ki(n,e){if(n=L(n,W),St("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new c(d,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new x(n,null,(function(r){return new se(y.emptyPath(),r)})(e))}function Vi(n,e,...t){if(n=v(n),arguments.length===1&&(e=Lr.newId()),St("doc","path",e),n instanceof W){const r=y.fromString(e,...t);return Wt(r),new g(n,null,new T(r))}{if(!(n instanceof g||n instanceof M))throw new c(d,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(y.fromString(e,...t));return Wt(r),new g(n.firestore,n instanceof M?n.converter:null,new T(r))}}function Wi(n,e){return n=v(n),e=v(e),(n instanceof g||n instanceof M)&&(e instanceof g||e instanceof M)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function nr(n,e){return n=v(n),e=v(e),n instanceof x&&e instanceof x&&n.firestore===e.firestore&&si(n._query,e._query)&&n.converter===e.converter}class O{constructor(e){this._byteString=e}static fromBase64String(e){try{return new O(G.fromBase64String(e))}catch(t){throw new c(d,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new O(G.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:O._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Se(e,O._jsonSchema))return O.fromBase64String(e.bytes)}}O._jsonSchemaVersion="firestore/bytes/1.0",O._jsonSchema={type:C("string",O._jsonSchemaVersion),bytes:C("string")};class oe{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new c(d,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new k(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function Ji(){return new oe(ft)}class ae{constructor(e){this._methodName=e}}class z{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new c(d,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new c(d,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return E(this._lat,e._lat)||E(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:z._jsonSchemaVersion}}static fromJSON(e){if(Se(e,z._jsonSchema))return new z(e.latitude,e.longitude)}}z._jsonSchemaVersion="firestore/geoPoint/1.0",z._jsonSchema={type:C("string",z._jsonSchemaVersion),latitude:C("number"),longitude:C("number")};class U{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:U._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Se(e,U._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new U(e.vectorValues);throw new c(d,"Expected 'vectorValues' field to be a number array")}}}U._jsonSchemaVersion="firestore/vectorValue/1.0",U._jsonSchema={type:C("string",U._jsonSchemaVersion),vectorValues:C("object")};const Pi=/^__.*__$/;class Ri{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new kt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Kn(e,this.data,t,this.fieldTransforms)}}class rr{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new kt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function ir(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw _(40011,{it:n})}}class et{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.st(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get it(){return this.settings.it}ot(e){return new et({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ut(e){const t=this.path?.child(e),r=this.ot({path:t,_t:!1});return r.ct(e),r}lt(e){const t=this.path?.child(e),r=this.ot({path:t,_t:!1});return r.st(),r}ht(e){return this.ot({path:void 0,_t:!0})}ft(e){return Ge(e,this.settings.methodName,this.settings.dt||!1,this.path,this.settings.Et)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}st(){if(this.path)for(let e=0;e<this.path.length;e++)this.ct(this.path.get(e))}ct(e){if(e.length===0)throw this.ft("Document fields must not be empty");if(ir(this.it)&&Pi.test(e))throw this.ft('Document fields cannot begin and end with "__"')}}class Si{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Nt(e)}Tt(e,t,r,i=!1){return new et({it:e,methodName:t,Et:r,path:k.emptyPath(),_t:!1,dt:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ue(n){const e=n._freezeSettings(),t=Nt(n._databaseId);return new Si(n._databaseId,!!e.ignoreUndefinedProperties,t)}function tt(n,e,t,r,i,s={}){const o=n.Tt(s.merge||s.mergeFields?2:0,e,t,i);$t("Data must be an object, but it was:",o,r);const a=ar(r,o);let u,l;if(s.merge)u=new re(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){const h=[];for(const f of s.mergeFields){const m=Pe(e,f,t);if(!o.contains(m))throw new c(d,`Field '${m}' is specified in your field mask but missing from your input data.`);lr(h,m)||h.push(m)}u=new re(h),l=o.fieldTransforms.filter((f=>u.covers(f.field)))}else u=null,l=o.fieldTransforms;return new Ri(new N(a),u,l)}class be extends ae{_toFieldTransform(e){if(e.it!==2)throw e.it===1?e.ft(`${this._methodName}() can only appear at the top level of your update data`):e.ft(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof be}}function sr(n,e,t){return new et({it:3,Et:e.settings.Et,methodName:n._methodName,_t:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Dt extends ae{_toFieldTransform(e){return new Ye(e.path,new Bn)}isEqual(e){return e instanceof Dt}}class xt extends ae{constructor(e,t){super(e),this.Pt=t}_toFieldTransform(e){const t=sr(this,e,!0),r=this.Pt.map((s=>le(s,t))),i=new zn(r);return new Ye(e.path,i)}isEqual(e){return e instanceof xt&&Ke(this.Pt,e.Pt)}}class qt extends ae{constructor(e,t){super(e),this.Pt=t}_toFieldTransform(e){const t=sr(this,e,!0),r=this.Pt.map((s=>le(s,t))),i=new Qn(r);return new Ye(e.path,i)}isEqual(e){return e instanceof qt&&Ke(this.Pt,e.Pt)}}class Ot extends ae{constructor(e,t){super(e),this.At=t}_toFieldTransform(e){const t=new Gn(e.serializer,jn(e.serializer,this.At));return new Ye(e.path,t)}isEqual(e){return e instanceof Ot&&this.At===e.At}}function Ct(n,e,t,r){const i=n.Tt(1,e,t);$t("Data must be an object, but it was:",i,r);const s=[],o=N.empty();Re(r,((u,l)=>{const h=Mt(e,u,t);l=v(l);const f=i.lt(h);if(l instanceof be)s.push(h);else{const m=le(l,f);m!=null&&(s.push(h),o.set(h,m))}}));const a=new re(s);return new rr(o,a,i.fieldTransforms)}function Lt(n,e,t,r,i,s){const o=n.Tt(1,e,t),a=[Pe(e,r,t)],u=[i];if(s.length%2!=0)throw new c(d,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<s.length;m+=2)a.push(Pe(e,s[m])),u.push(s[m+1]);const l=[],h=N.empty();for(let m=a.length-1;m>=0;--m)if(!lr(l,a[m])){const P=a[m];let V=u[m];V=v(V);const q=o.lt(P);if(V instanceof be)l.push(P);else{const $=le(V,q);$!=null&&(l.push(P),h.set(P,$))}}const f=new re(l);return new rr(h,f,o.fieldTransforms)}function or(n,e,t,r=!1){return le(t,n.Tt(r?4:3,e))}function le(n,e){if(ur(n=v(n)))return $t("Unsupported field value:",e,n),ar(n,e);if(n instanceof ae)return(function(r,i){if(!ir(i.it))throw i.ft(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.ft(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings._t&&e.it!==4)throw e.ft("Nested arrays are not supported");return(function(r,i){const s=[];let o=0;for(const a of r){let u=le(a,i.ht(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}})(n,e)}return(function(r,i){if((r=v(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return jn(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=I.fromDate(r);return{timestampValue:_t(i.serializer,s)}}if(r instanceof I){const s=new I(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:_t(i.serializer,s)}}if(r instanceof z)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof O)return{bytesValue:ci(i.serializer,r._byteString)};if(r instanceof g){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.ft(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Ft(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof U)return(function(o,a){return{mapValue:{fields:{[Nn]:{stringValue:Dn},[$e]:{arrayValue:{values:o.toArray().map((l=>{if(typeof l!="number")throw a.ft("VectorValues must only contain numeric values.");return Un(a.serializer,l)}))}}}}}})(r,i);throw i.ft(`Unsupported field value: ${Je(r)}`)})(n,e)}function ar(n,e){const t={};return(function(i){for(const s in i)if(Object.prototype.hasOwnProperty.call(i,s))return!1;return!0})(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Re(n,((r,i)=>{const s=le(i,e.ut(r));s!=null&&(t[r]=s)})),{mapValue:{fields:t}}}function ur(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof I||n instanceof z||n instanceof O||n instanceof g||n instanceof ae||n instanceof U)}function $t(n,e,t){if(!ur(t)||!Rn(t)){const r=Je(t);throw r==="an object"?e.ft(n+" a custom object"):e.ft(n+" "+r)}}function Pe(n,e,t){if((e=v(e))instanceof oe)return e._internalPath;if(typeof e=="string")return Mt(n,e);throw Ge("Field path arguments must be of type string or ",n,!1,void 0,t)}const bi=new RegExp("[~\\*/\\[\\]]");function Mt(n,e,t){if(e.search(bi)>=0)throw Ge(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new oe(...e.split("."))._internalPath}catch{throw Ge(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ge(n,e,t,r,i){const s=r&&!r.isEmpty(),o=i!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new c(d,a+n+u)}function lr(n,e){return n.some((t=>t.isEqual(e)))}class ie{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new g(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new cr(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ut("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class cr extends ie{data(){return super.data()}}class Tt{constructor(e,t){this._docs=t,this.query=e}get docs(){return[...this._docs]}get size(){return this.docs.length}get empty(){return this.docs.length===0}forEach(e,t){this._docs.forEach(e,t)}}function ki(n,e){return n=v(n),e=v(e),n instanceof ie&&e instanceof ie?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Tt&&e instanceof Tt&&nr(n.query,e.query)&&Rt(n.docs,e.docs,ki)}function Ut(n,e){return typeof e=="string"?Mt(n,e):e instanceof oe?e._internalPath:e._delegate._internalPath}class jt{}class ke extends jt{}function Hi(n,e,...t){let r=[];e instanceof jt&&r.push(e),r=r.concat(t),(function(s){const o=s.filter((u=>u instanceof _e)).length,a=s.filter((u=>u instanceof Fe)).length;if(o>1||o>0&&a>0)throw new c(d,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)n=i._apply(n);return n}class Fe extends ke{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Fe(e,t,r)}_apply(e){const t=this._parse(e);return dr(e._query,t),new x(e.firestore,e.converter,pt(e._query,t))}_parse(e){const t=ue(e.firestore);return(function(s,o,a,u,l,h,f){let m;if(l.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new c(d,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){fn(f,h);const V=[];for(const q of f)V.push(dn(u,s,q));m={arrayValue:{values:V}}}else m=dn(u,s,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||fn(f,h),m=or(a,o,f,h==="in"||h==="not-in");return D.create(l,h,m)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Yi(n,e,t){const r=e,i=Ut("where",n);return Fe._create(i,r,t)}class _e extends jt{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new _e(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:ne.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(i,s){let o=i;const a=s.getFlattenedFilters();for(const u of a)dr(o,u),o=pt(o,u)})(e._query,t),new x(e.firestore,e.converter,pt(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function Xi(...n){return n.forEach((e=>fr("or",e))),_e._create("or",n)}function Zi(...n){return n.forEach((e=>fr("and",e))),_e._create("and",n)}class Bt extends ke{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Bt(e,t)}_apply(e){const t=(function(i,s,o){if(i.startAt!==null)throw new c(d,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new c(d,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Be(s,o)})(e._query,this._field,this._direction);return new x(e.firestore,e.converter,(function(i,s){const o=i.explicitOrderBy.concat([s]);return new se(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(e._query,t))}}function es(n,e="asc"){const t=e,r=Ut("orderBy",n);return Bt._create(r,t)}class nt extends ke{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new nt(e,t,r)}_apply(e){return new x(e.firestore,e.converter,(function(r,i,s){return new se(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),i,s,r.startAt,r.endAt)})(e._query,this._limit,this._limitType))}}function ts(n){return Sn("limit",n),nt._create("limit",n,"F")}function ns(n){return Sn("limitToLast",n),nt._create("limitToLast",n,"L")}class rt extends ke{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new rt(e,t,r)}_apply(e){const t=hr(e,this.type,this._docOrFields,this._inclusive);return new x(e.firestore,e.converter,(function(i,s){return new se(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)})(e._query,t))}}function rs(...n){return rt._create("startAt",n,!0)}function is(...n){return rt._create("startAfter",n,!1)}class it extends ke{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new it(e,t,r)}_apply(e){const t=hr(e,this.type,this._docOrFields,this._inclusive);return new x(e.firestore,e.converter,(function(i,s){return new se(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)})(e._query,t))}}function ss(...n){return it._create("endBefore",n,!1)}function os(...n){return it._create("endAt",n,!0)}function hr(n,e,t,r){if(t[0]=v(t[0]),t[0]instanceof ie)return(function(s,o,a,u,l){if(!u)throw new c(It,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of $n(s))if(f.field.isKeyField())h.push(Ue(o,u.key));else{const m=u.data.field(f.field);if(bt(m))throw new c(d,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){const P=f.field.canonicalString();throw new c(d,`Invalid query. You are trying to start or end a query using a document for which the field '${P}' (used as the orderBy) does not exist.`)}h.push(m)}return new je(h,l)})(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=ue(n.firestore);return(function(o,a,u,l,h,f){const m=o.explicitOrderBy;if(h.length>m.length)throw new c(d,`Too many arguments provided to ${l}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const P=[];for(let V=0;V<h.length;V++){const q=h[V];if(m[V].field.isKeyField()){if(typeof q!="string")throw new c(d,`Invalid query. Expected a string for document ID in ${l}(), but got a ${typeof q}`);if(!Ln(o)&&q.indexOf("/")!==-1)throw new c(d,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${l}() must be a plain document ID, but '${q}' contains a slash.`);const $=o.path.child(y.fromString(q));if(!T.isDocumentKey($))throw new c(d,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${l}() must result in a valid document path, but '${$}' is not because it contains an odd number of segments.`);const ce=new T($);P.push(Ue(a,ce))}else{const $=or(u,l,q);P.push($)}}return new je(P,f)})(n._query,n.firestore._databaseId,i,e,t,r)}}function dn(n,e,t){if(typeof(t=v(t))=="string"){if(t==="")throw new c(d,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ln(e)&&t.indexOf("/")!==-1)throw new c(d,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(y.fromString(t));if(!T.isDocumentKey(r))throw new c(d,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ue(n,new T(r))}if(t instanceof g)return Ue(n,t._key);throw new c(d,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Je(t)}.`)}function fn(n,e){if(!Array.isArray(n)||n.length===0)throw new c(d,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function dr(n,e){const t=(function(i,s){for(const o of i)for(const a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null})(n.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new c(d,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new c(d,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function fr(n,e){if(!(e instanceof Fe||e instanceof _e))throw new c(d,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class Fi{convertValue(e,t="none"){switch(te(e)){case 0:return null;case 1:return e.booleanValue;case 2:return A(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ee(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw _(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Re(e,((i,s)=>{r[i]=this.convertValue(s,t)})),r}convertVectorValue(e){const t=e.fields?.[$e].arrayValue?.values?.map((r=>A(r.doubleValue)));return new U(t)}convertGeoPoint(e){return new z(A(e.latitude),A(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Fn(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Ae(e));default:return null}}convertTimestamp(e){const t=ee(e);return new I(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=y.fromString(e);F(Yn(r),9688,{name:e});const i=new we(r.get(1),r.get(3)),s=new T(r.popFirst(5));return i.isEqual(t)||We(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function st(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class ot extends Fi{constructor(e){super(),this.firestore=e}convertBytes(e){return new O(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new g(this.firestore,null,t)}}function as(n){const e=K((n=L(n,g)).firestore),t=new ot(n.firestore);return Zn(e,[n._key]).then((r=>{F(r.length===1,15618);const i=r[0];return new ie(n.firestore,t,n._key,i.isFoundDocument()?i:null,n.converter)}))}function us(n){(function(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new c(Vt,"limitToLast() queries require specifying at least one orderBy() clause")})((n=L(n,x))._query);const e=K(n.firestore),t=new ot(n.firestore);return wi(e,n._query).then((r=>{const i=r.map((s=>new cr(n.firestore,t,s.key,s,n.converter)));return n._query.limitType==="L"&&i.reverse(),new Tt(n,i)}))}function ls(n,e,t){const r=st((n=L(n,g)).converter,e,t),i=tt(ue(n.firestore),"setDoc",n._key,r,n.converter!==null,t);return pe(K(n.firestore),[i.toMutation(n._key,S.none())])}function cs(n,e,t,...r){const i=ue((n=L(n,g)).firestore);let s;return s=typeof(e=v(e))=="string"||e instanceof oe?Lt(i,"updateDoc",n._key,e,t,r):Ct(i,"updateDoc",n._key,e),pe(K(n.firestore),[s.toMutation(n._key,S.exists(!0))])}function hs(n){return pe(K((n=L(n,g)).firestore),[new Ze(n._key,S.none())])}function ds(n,e){const t=Vi(n=L(n,M)),r=st(n.converter,e),i=tt(ue(n.firestore),"addDoc",t._key,r,t.converter!==null,{});return pe(K(n.firestore),[i.toMutation(t._key,S.exists(!1))]).then((()=>t))}function fs(n){return Ni(n,{count:Di()})}function Ni(n,e){const t=L(n.firestore,W),r=K(t),i=(function(o,a){const u=[];for(const l in o)Object.prototype.hasOwnProperty.call(o,l)&&u.push(a(o[l],l,o));return u})(e,((s,o)=>new Gr(o,s.aggregateType,s._internalFieldPath)));return Ei(r,n._query,i).then((s=>(function(a,u,l){const h=new ot(a);return new vi(u,h,l)})(t,n,s)))}function ms(n){return new Ve("sum",Pe("sum",n))}function ps(n){return new Ve("avg",Pe("average",n))}function Di(){return new Ve("count")}function _s(n,e){return n instanceof Ve&&e instanceof Ve&&n.aggregateType===e.aggregateType&&n._internalFieldPath?.canonicalString()===e._internalFieldPath?.canonicalString()}function gs(n,e){return nr(n.query,e.query)&&Ke(n.data(),e.data())}function ys(){return new be("deleteField")}function Ts(){return new Dt("serverTimestamp")}function ws(...n){return new xt("arrayUnion",n)}function Es(...n){return new qt("arrayRemove",n)}function As(n){return new Ot("increment",n)}function Is(n){return new U(n)}class xi{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ue(e)}set(e,t,r){this._verifyNotCommitted();const i=H(e,this._firestore),s=st(i.converter,t,r),o=tt(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,S.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=H(e,this._firestore);let o;return o=typeof(t=v(t))=="string"||t instanceof oe?Lt(this._dataReader,"WriteBatch.update",s._key,t,r,i):Ct(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,S.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=H(e,this._firestore);return this._mutations=this._mutations.concat(new Ze(t._key,S.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new c(Q,"A write batch can no longer be used after commit() has been called.")}}function H(n,e){if((n=v(n)).firestore!==e)throw new c(d,"Provided document reference is from a different Firestore instance.");return n}function vs(n){const e=K(n=L(n,W));return new xi(n,(t=>pe(e,t)))}class qi{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new c(d,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await Zn(this.datastore,e);return t.forEach((r=>this.recordVersion(r))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ze(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((t,r)=>{const i=T.fromPath(r);this.mutations.push(new Wn(i,this.precondition(i)))})),await pe(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw _(50498,{Rt:e.constructor.name});t=w.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new c(vt,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(w.min())?S.exists(!1):S.updateTime(t):S.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(w.min()))throw new c(d,"Can't update a document that doesn't exist.");return S.updateTime(t)}return S.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}const Oi={maxAttempts:5};class Ci{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Vt=r.maxAttempts,this.It=new Xn(this.asyncQueue,"transaction_retry")}yt(){this.Vt-=1,this.gt()}gt(){this.It.Z((async()=>{const e=new qi(this.datastore),t=this.wt(e);t&&t.then((r=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(r)})).catch((i=>{this.Ft(i)}))))})).catch((r=>{this.Ft(r)}))}))}wt(e){try{const t=this.updateFunction(e);return!kn(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Ft(e){this.Vt>0&&this.vt(e)?(this.Vt-=1,this.asyncQueue.enqueueAndForget((()=>(this.gt(),Promise.resolve())))):this.deferred.reject(e)}vt(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!(function(i){switch(i){case ht:return _(64938);case At:case de:case wn:case An:case vn:case Vn:case Oe:return!1;case d:case It:case Sr:case En:case Q:case vt:case In:case Vt:case br:return!0;default:return _(15467,{code:i})}})(t)}return!1}}function ct(){return typeof document<"u"?document:null}class zt{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Pt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,a=new zt(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new c(At,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}const mn="AsyncQueue";class Li{constructor(e=Promise.resolve()){this.Dt=[],this.bt=!1,this.St=[],this.Ct=null,this.Nt=!1,this.Ot=!1,this.qt=[],this.It=new Xn(this,"async_queue_retry"),this.Bt=()=>{const r=ct();r&&X(mn,"Visibility state changed to "+r.visibilityState),this.It.tt()},this.$t=e;const t=ct();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Bt)}get isShuttingDown(){return this.bt}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Qt(),this.kt(e)}enterRestrictedMode(e){if(!this.bt){this.bt=!0,this.Ot=e||!1;const t=ct();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Bt)}}enqueue(e){if(this.Qt(),this.bt)return new Promise((()=>{}));const t=new Pt;return this.kt((()=>this.bt&&this.Ot?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Dt.push(e),this.Lt())))}async Lt(){if(this.Dt.length!==0){try{await this.Dt[0](),this.Dt.shift(),this.It.reset()}catch(e){if(!(function(r){return r.name==="IndexedDbTransactionError"})(e))throw e;X(mn,"Operation failed with retryable error: "+e)}this.Dt.length>0&&this.It.Z((()=>this.Lt()))}}kt(e){const t=this.$t.then((()=>(this.Nt=!0,e().catch((r=>{throw this.Ct=r,this.Nt=!1,We("INTERNAL UNHANDLED ERROR: ",pn(r)),r})).then((r=>(this.Nt=!1,r))))));return this.$t=t,t}enqueueAfterDelay(e,t,r){this.Qt(),this.qt.indexOf(e)>-1&&(t=0);const i=zt.createAndSchedule(this,e,t,r,(s=>this.Mt(s)));return this.St.push(i),i}Qt(){this.Ct&&_(47125,{xt:pn(this.Ct)})}verifyOperationInProgress(){}async Ut(){let e;do e=this.$t,await e;while(e!==this.$t)}jt(e){for(const t of this.St)if(t.timerId===e)return!0;return!1}zt(e){return this.Ut().then((()=>{this.St.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.St)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Ut()}))}Wt(e){this.qt.push(e)}Mt(e){const t=this.St.indexOf(e);this.St.splice(t,1)}}function pn(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class $i{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=ue(e)}get(e){const t=H(e,this._firestore),r=new ot(this._firestore);return this._transaction.lookup([t._key]).then((i=>{if(!i||i.length!==1)return _(24041);const s=i[0];if(s.isFoundDocument())return new ie(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new ie(this._firestore,r,t._key,null,t.converter);throw _(18433,{doc:s})}))}set(e,t,r){const i=H(e,this._firestore),s=st(i.converter,t,r),o=tt(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){const s=H(e,this._firestore);let o;return o=typeof(t=v(t))=="string"||t instanceof oe?Lt(this._dataReader,"Transaction.update",s._key,t,r,i):Ct(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){const t=H(e,this._firestore);return this._transaction.delete(t._key),this}}function Vs(n,e,t){const r=K(n=L(n,W)),i={...Oi,...t};(function(a){if(a.maxAttempts<1)throw new c(d,"Max attempts must be at least 1")})(i);const s=new Pt;return new Ci((function(){return new Li})(),r,i,(o=>e(new $i(n,o))),s).yt(),s.promise}(function(){(function(t){me=t})(`${vr}_lite`),Vr(new Pr("firestore/lite",((e,{instanceIdentifier:t,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new W(new Nr(e.getProvider("auth-internal")),new qr(i,e.getProvider("app-check-internal")),(function(a,u){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new c(d,'"projectId" not provided in firebase.initializeApp.');return new we(a.options.projectId,u)})(i,t),i);return r&&s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),Qt("firestore-lite",Gt,""),Qt("firestore-lite",Gt,"esm2020")})();export{Ve as AggregateField,vi as AggregateQuerySnapshot,O as Bytes,M as CollectionReference,g as DocumentReference,ie as DocumentSnapshot,oe as FieldPath,ae as FieldValue,W as Firestore,c as FirestoreError,z as GeoPoint,x as Query,_e as QueryCompositeFilterConstraint,ke as QueryConstraint,cr as QueryDocumentSnapshot,it as QueryEndAtConstraint,Fe as QueryFieldFilterConstraint,nt as QueryLimitConstraint,Bt as QueryOrderByConstraint,Tt as QuerySnapshot,rt as QueryStartAtConstraint,I as Timestamp,$i as Transaction,U as VectorValue,xi as WriteBatch,ds as addDoc,_s as aggregateFieldEqual,gs as aggregateQuerySnapshotEqual,Zi as and,Es as arrayRemove,ws as arrayUnion,ps as average,Gi as collection,Ki as collectionGroup,Ii as connectFirestoreEmulator,Di as count,hs as deleteDoc,ys as deleteField,Vi as doc,Ji as documentId,os as endAt,ss as endBefore,Ni as getAggregate,fs as getCount,as as getDoc,us as getDocs,zi as getFirestore,As as increment,Bi as initializeFirestore,ts as limit,ns as limitToLast,Xi as or,es as orderBy,Hi as query,nr as queryEqual,Wi as refEqual,Vs as runTransaction,Ts as serverTimestamp,ls as setDoc,Ui as setLogLevel,ki as snapshotEqual,is as startAfter,rs as startAt,ms as sum,Qi as terminate,cs as updateDoc,Is as vector,Yi as where,vs as writeBatch};
